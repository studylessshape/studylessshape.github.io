<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.147.7"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><meta name=description content="这段时间使用 ConfuserEx2 加密混淆 C# 程序的方法"><title>使用 ConfuserEX2 加密混淆 C# 程序&nbsp;&ndash;&nbsp;学少何Blog</title><link rel=stylesheet href=/css/core.min.32478a57f52c16ea8d985cfbd2d28edda6d39bfc82a9b118b94caa532c16ce3f1e869e1d49ccce4a74134efed6bdafa0.css integrity=sha384-MkeKV/UsFuqNmFz70tKO3abTm/yCqbEYuUyqUywWzj8ehp4dSczOSnQTTv7Wva+g><meta name=twitter:card content="summary"><meta name=twitter:title content="使用 ConfuserEX2 加密混淆 C# 程序"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">学少何Blog</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories>归类</a><a class="nav item" href=/tags>标签</a><a class="nav item" href=/about>关于</a><a class="nav item" href=/index%2exml>RSS</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">使用 ConfuserEX2 加密混淆 C# 程序</h1><p class="article date">2025年6月5日 6:05</p></section><article class="article markdown-body"><h2 id=为什么需要对-c-程序进行混淆和加密>为什么需要对 C# 程序进行混淆和加密</h2><p>通常需要这样做大多是因为商业项目。</p><p>就我个人情况而言，目前是在为一个公司使用的软件编写插件，有外发需求，所以需要对插件进行代码加密。</p><h2 id=快速使用>快速使用</h2><p>目前我用得最舒适的方式是将 ConfuserEx 集成到项目中，并在编译的同时进行加密操作。</p><blockquote><p>ConfuserEx 的生成操作为，在项目构建完成之后，会将指定的文件进行加密，并根据配置来决定是否替换掉原文件。</p></blockquote><h3 id=使用前>使用前</h3><p>ConfuserEx2 推荐去 Github 的 <a href=https://github.com/mkaring/ConfuserEx/releases/latest target=_blank rel="noopener noreferrer">Release 界面</a>下载一个最新的 GUI 工具，方便管理和添加加密规则。</p><h3 id=初始化加密>初始化加密</h3><p>对于新建或者已有的 C# 项目，可以通过 Visual Studio 的包管理，或者通过 nuget 包管理器添加 ConfuserEx 的 MSBuild 包。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet add package Confuser.MSBuild --version 1.6.0
</span></span></code></pre></div><p>然后打开 ConfuserEx 的 GUI 工具，点击加号添加一个需要加密的文件，可以是 DLL 也可以是 EXE。当然，这个文件最好是单独的一个项目生成的文件。</p><p>比如此处我的项目是 <code>Less.Utils</code>，所以我添加了 <code>Less.Utils.dll</code> 文件。</p><p><img loading=lazy src=01.add-dll-by-confuser.jpg alt=add-dll-by-confuser></p><p>然后在 <code>Settings</code> 选项卡中，找到刚才添加的文件，然后点击右侧的加号添加一个加密规则。再点击编辑图标修改规则。</p><p><code>Preset</code> 是预设，建议选择 <code>None</code>，如果是加密应用程序可以按照需要选择。</p><p>点击在 <code>Protection</code> 下方右侧的加号即可添加一个加密规则。加密规则可以有很多个可以选择。</p><p>目前 ConfuserEx 支持的规则有（描述都为机翻）：</p><ul><li><code>Anti Debug</code>：此保护可防止对程序集进行调试或分析。</li><li><code>Anti Dump</code>：此保护可防止从内存中转储程序集。</li><li><code>Anti IL Dasm</code>：此保护使用阻止 ILDasm 反汇编的属性标记模块。</li><li><code>Anti Tamper</code>：此保护可确保应用程序的完整性。</li><li><code>Constants</code>：此保护对代码中的常量进行编码和压缩。</li><li><code>Control Flow</code>：此保护会破坏方法中的代码，以便反编译器无法反编译方法。</li><li><code>Protection Hardening</code>：此组件改进了保护代码，使其更难绕过它。</li><li><code>Invalid Metadata</code>：此保护将无效的元数据添加到模块中，以防止反汇编器/反编译器打开它们。</li><li><code>Resources</code>：此保护对嵌入的资源进行编码和压缩。</li><li><code>Type Scrambler</code>：将类型替换为泛型。</li><li><code>Name</code>：此保护会混淆符号的名称，因此既不能编译也不能读取反编译的源代码。</li><li><code>Watermarking</code>：这会将水印应用于程序集，表明 ConfuserEx 保护了程序集。所以人们试图扭转混淆，知道放弃。</li></ul><p>对于类库的加密，目前个人添加的是 <code>Anti Dump</code>、<code>Anti IL Dasm</code>、<code>Anti Tamper</code>、<code>Constants</code>、<code>Control Flow</code> 这 5 项。</p><p>添加完成后，点击工具栏的 <code>Save Project</code>，保存到项目的根目录下，文件命名和项目名需要一致。</p><h3 id=项目设置>项目设置</h3><p>加密会影响调试，所以首选需要设置在 Release 模式下才进行加密。</p><p>双击项目打开项目文件，在文件中添加下面的内容：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;PropertyGroup</span> <span class=na>Condition=</span><span class=s>&#34;&#39;$(Configuration)&#39; == &#39;Release&#39;&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;Obfuscate&gt;</span>true<span class=nt>&lt;/Obfuscate&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;ConfuserReplaceOutput&gt;</span>true<span class=nt>&lt;/ConfuserReplaceOutput&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/PropertyGroup&gt;</span>
</span></span></code></pre></div><p>这几行配置了在 Release 模式下启用加密，并替换掉原来的文件。</p><p>然后打开刚才保存的加密配置文件，文件名为 <code>&lt;项目名>.crproj</code>。如果在 VS 中不存在，可以通过右键项目，添加现有项来添加。</p><p>打开之后，将路径替换为 <code>$(Output)</code>，修改后保存。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;project</span> <span class=na>outputDir=</span><span class=s>&#34;$(Output)\Confused&#34;</span> <span class=na>baseDir=</span><span class=s>&#34;$(Output)&#34;</span> <span class=na>xmlns=</span><span class=s>&#34;http://confuser.codeplex.com&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;module</span> <span class=na>path=</span><span class=s>&#34;Less.Utils.dll&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;rule</span> <span class=na>pattern=</span><span class=s>&#34;true&#34;</span> <span class=na>inherit=</span><span class=s>&#34;false&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;protection</span> <span class=na>id=</span><span class=s>&#34;anti dump&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;protection</span> <span class=na>id=</span><span class=s>&#34;anti ildasm&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;protection</span> <span class=na>id=</span><span class=s>&#34;anti tamper&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;protection</span> <span class=na>id=</span><span class=s>&#34;constants&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;protection</span> <span class=na>id=</span><span class=s>&#34;ctrl flow&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/rule&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/module&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/project&gt;</span>
</span></span></code></pre></div><p>这样，加密配置就完成了。现在在 Release 模式下编译的生成的文件，就会应用上面的加密规则。</p><h2 id=市面上的加密工具>市面上的加密工具</h2><h3 id=dotfuscator>Dotfuscator</h3><p>可以直接使用 Visual Studio Installer，在其单个组件中找到并安装。安装之后在 Visual Studio 中使用功能搜索 dot，就能够使用了。相对来说使用方便，但是免费版加密程度有限，而且在我实际使用时，加密后的插件无法正常使用，所以不太推荐。</p><p>不过如果是加密应用程序，应该还是没有问题的。</p><h3 id=agilenet>Agile.NET</h3><p><a href=https://www.secureteam.net/acode-features-detailed target=_blank rel="noopener noreferrer">Agile.NET</a> 是一个商业的加密工具，功能强大，但是需要付费，而且价格不便宜。</p><p>不过效果确实看着不错，加密后的代码公开方法和类型都能够正常用 ILSpy 和 dnSpy 查看，只是方法体全被去掉了。</p><h3 id=结界net>结界.NET</h3><p><a href=https://github.com/dcsoft-yyf/JIEJIE.NET target=_blank rel="noopener noreferrer">结界.NET</a> 是开源的命令行加密工具，同时也有 GUI 界面。使用方法可以看一下这个博客 -> <a href=https://www.cnblogs.com/dotnet-box/p/17360983.html target=_blank rel="noopener noreferrer">【JIEJIE.NET - 强大的 .NET 代码混淆工具】</a></p><p>不过这个加密工具同样是不推荐对类库进行加密，个人只推荐加密应用程序。</p><h3 id=confuserex2>ConfuserEX2</h3><p><a href=https://github.com/mkaring/ConfuserEx target=_blank rel="noopener noreferrer">ConfuserEx2</a>，也是原作者停止更新后，社区其他开发者接手更新的项目。目前没有继续发布新的稳定版本了，但是还在继续更新。</p><p>这个工具除了 GUI 的界面，还有对应的 nuget 包 <a href=https://www.nuget.org/packages/Confuser.MSBuild target=_blank rel="noopener noreferrer">Confuser.MSBuild</a>，能够在项目编译的同时进行加密操作。</p><p>就个人目前使用体验而言，这个是用起来最无感且最方便的。</p><h2 id=一些反编译工具>一些反编译工具</h2><ul><li><a href=https://github.com/icsharpcode/ILSpy target=_blank rel="noopener noreferrer">ILSpy</a></li><li><a href=https://github.com/dnSpyEx/dnSpy target=_blank rel="noopener noreferrer">dnSpy(Ex)</a> <em>这个是原作者停止维护后，其他开发者接手并持续更新的项目</em></li></ul><p>dnSpy 可以修改并重新编译程序和 DLL 文件，相对来说功能更强大。</p></article><section class="article labels"><a class=category href=/categories/c%23/>C#</a><a class=tag href=/tags/c%23/>C#</a><a class=tag href=/tags/confuserex2/>ConfuserEX2</a><a class=tag href=/tags/%E6%B7%B7%E6%B7%86/>混淆</a><a class=tag href=/tags/%E4%BB%A3%E7%A0%81%E5%8A%A0%E5%AF%86/>代码加密</a></section><section class="article author"><p class=name>学少何</p><div class=bio><em>不求上进的社畜……</em></div><div class=details><a class=item href=https://github.com/studylessshape target=_blank rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;studylessshape</a></div></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/post/rust/how-to-init-llvm-sys/><span class="iconfont icon-article"></span>如何初始化 llvm-sys</a></p></section></div></section><section id=footer><div style=display:flex;flex-direction:column;flex-wrap:wrap;justify-content:center;align-content:center;align-items:center><p style=flex-shrink:0>© 2024 学少何</p><p><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://github.com/cntrump/hugo-notepadium target=_blank>Notepadium</a></p></div></section><script src=/js/hljs.min.68c549b01f2c96722917d73ba8d112d8d9bb5f891629166b777f3ff2810da2a2c9bde56eea10013cc86b58b4da4fe858.js integrity=sha384-aMVJsB8slnIpF9c7qNES2Nm7X4kWKRZrd38/8oENoqLJveVu6hABPMhrWLTaT+hY></script><script>hljs.initHighlightingOnLoad()</script></body></html>