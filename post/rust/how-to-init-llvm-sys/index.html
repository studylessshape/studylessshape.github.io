<!doctype html><html lang=zh><meta charset=utf-8><meta name=generator content="Hugo 0.119.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=color-scheme content="light dark"><meta name=supported-color-schemes content="light dark"><title>如何初始化 llvm-sys&nbsp;&ndash;&nbsp;学少何Blog</title><link rel=stylesheet href=/css/core.min.32478a57f52c16ea8d985cfbd2d28edda6d39bfc82a9b118b94caa532c16ce3f1e869e1d49ccce4a74134efed6bdafa0.css integrity=sha384-MkeKV/UsFuqNmFz70tKO3abTm/yCqbEYuUyqUywWzj8ehp4dSczOSnQTTv7Wva+g><meta name=twitter:card content="summary"><meta name=twitter:title content="如何初始化 llvm-sys"><body><section id=header><div class="header wrap"><span class="header left-side"><a class="site home" href=/><span class="site name">学少何Blog</span></a></span>
<span class="header right-side"><div class="nav wrap"><nav class=nav><a class="nav item" href=/categories>归类</a><a class="nav item" href=/tags>标签</a><a class="nav item" href=/about>关于</a><a class="nav item" href=/index%2exml>RSS</a></nav></div></span></div></section><section id=content><div class=article-container><section class="article header"><h1 class="article title">如何初始化 llvm-sys</h1><p class="article date">2024年11月23日 11:23</p></section><article class="article markdown-body"><h2 id=导入-llvm-sys库>导入 llvm-sys库</h2><p>添加 crate <a href=https://crates.io/crates/llvm-sys target=_blank rel="noopener noreferrer">llvm-sys</a> 到现有的项目中。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>cargo add llvm-sys
</span></span></code></pre></div><p>如果有指定 llvm 版本需求，可以指定版本，比如版本 <code>18.1.x</code> 的 LLVM，可以指定 llmv-sys 的版本为 <code>180</code>。</p><p>目前最新版本支持到了 <code>190</code>，即当前最新版本 <code>19.1.0</code> 的 LLVM。</p><h2 id=编译问题>编译问题</h2><p>如果试用 rust-analyzer 或运行命令 <code>cargo check</code>，会提示一个错误。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>D:<span class=se>\P</span>rojects<span class=se>\r</span>ust<span class=se>\t</span>est-project&gt;cargo check                               
</span></span><span class=line><span class=cl>warning: unused manifest key: worksapce
</span></span><span class=line><span class=cl>   Compiling llvm-sys v191.0.0
</span></span><span class=line><span class=cl>error: No suitable version of LLVM was found system-wide or pointed
</span></span><span class=line><span class=cl>              to by LLVM_SYS_191_PREFIX.
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>              Consider using <span class=sb>`</span>llvmenv<span class=sb>`</span> to compile an appropriate copy of LLVM, and
</span></span><span class=line><span class=cl>              refer to the llvm-sys documentation <span class=k>for</span> more information.
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>              llvm-sys: https://crates.io/crates/llvm-sys
</span></span><span class=line><span class=cl>              llvmenv: https://crates.io/crates/llvmenv
</span></span><span class=line><span class=cl>   --&gt; C:<span class=se>\U</span>sers<span class=se>\s</span>tudylessshape<span class=se>\.</span>cargo<span class=se>\r</span>egistry<span class=se>\s</span>rc<span class=se>\r</span>sproxy.cn-0dccff568467c15b<span class=se>\l</span>lvm-sys-191.0.0<span class=se>\s</span>rc/lib.rs:529:1
</span></span><span class=line><span class=cl>    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=m>529</span> <span class=p>|</span> / std::compile_error!<span class=o>(</span>concat!<span class=o>(</span>
</span></span><span class=line><span class=cl><span class=m>530</span> <span class=p>|</span> <span class=p>|</span>     <span class=s2>&#34;No suitable version of LLVM was found system-wide or pointed
</span></span></span><span class=line><span class=cl><span class=s2>531 | |        to by LLVM_SYS_&#34;</span>,
</span></span><span class=line><span class=cl><span class=m>532</span> <span class=p>|</span> <span class=p>|</span>     env!<span class=o>(</span><span class=s2>&#34;CARGO_PKG_VERSION_MAJOR&#34;</span><span class=o>)</span>,
</span></span><span class=line><span class=cl>...   <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=m>539</span> <span class=p>|</span> <span class=p>|</span>        llvmenv: https://crates.io/crates/llvmenv<span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>540 | | ));
</span></span></span><span class=line><span class=cl><span class=s2>    | |__^
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>error: could not compile `llvm-sys` (lib) due to 1 previous error
</span></span></span></code></pre></div><p>这是在提示需要为 <code>LLVM_SYS_191_PREFIX</code> 指定正确的 LLVM 路径。</p><h3 id=下载安装-llvm>下载安装 LLVM</h3><style type=text/css>.notice{--title-color:#fff;--title-background-color:#6be;--content-color:#444;--content-background-color:#e7f2fa}.notice.info{--title-background-color:#fb7;--content-background-color:#fec}.notice.tip{--title-background-color:#5a5;--content-background-color:#efe}.notice.warning{--title-background-color:#c33;--content-background-color:#fee}@media(prefers-color-scheme:dark){.notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}.notice.info{--title-background-color:#a50;--content-background-color:#420}.notice.tip{--title-background-color:#363;--content-background-color:#121}.notice.warning{--title-background-color:#800;--content-background-color:#400}}body.dark .notice{--title-color:#fff;--title-background-color:#069;--content-color:#ddd;--content-background-color:#023}body.dark .notice.info{--title-background-color:#a50;--content-background-color:#420}body.dark .notice.tip{--title-background-color:#363;--content-background-color:#121}body.dark .notice.warning{--title-background-color:#800;--content-background-color:#400}.notice{padding:18px;line-height:24px;margin-bottom:24px;border-radius:4px;color:var(--content-color);background:var(--content-background-color)}.notice p:last-child{margin-bottom:0}.notice-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:var(--title-color);background:var(--title-background-color)}.icon-notice{display:inline-flex;align-self:center;margin-right:8px}.icon-notice img,.icon-notice svg{height:1em;width:1em;fill:currentColor}.icon-notice img,.icon-notice.baseline svg{top:.125em;position:relative}</style><div class="notice info"><p class=notice-title><span class="icon-notice baseline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="92 59.5 300 300"><path d="M292 303.25V272c0-3.516-2.734-6.25-6.25-6.25H267v-1e2c0-3.516-2.734-6.25-6.25-6.25h-62.5c-3.516.0-6.25 2.734-6.25 6.25V197c0 3.516 2.734 6.25 6.25 6.25H217v62.5h-18.75c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h87.5c3.516.0 6.25-2.734 6.25-6.25zm-25-175V97c0-3.516-2.734-6.25-6.25-6.25h-37.5c-3.516.0-6.25 2.734-6.25 6.25v31.25c0 3.516 2.734 6.25 6.25 6.25h37.5c3.516.0 6.25-2.734 6.25-6.25zm125 81.25c0 82.813-67.188 150-150 150-82.813.0-150-67.188-150-150 0-82.813 67.188-150 150-150 82.813.0 150 67.188 150 150z"/></svg></span>信息</p><p>Linux 直接使用包管理器安装 LLVM，在安装完成后，试着输入命令 <code>llvm-config</code>，如果打印出了使用帮助信息，则可以不需要这一节的内容。</p></div><p>进入 LLVM 的官网 <a href=https://llvm.org/ target=_blank rel="noopener noreferrer">https://llvm.org/</a>，点击左侧的 <code>All Releases</code>，或者直接进入 <a href=https://releases.llvm.org/ target=_blank rel="noopener noreferrer">https://releases.llvm.org/</a>。</p><p>找到自己需要的版本，并点击 <u><code>Download</code></u>。</p><p><img src=download-llvm-page.png alt=download-llvm-page></p><p>目前的本人尝试下载的两个版本，都将下载地址放到了 github 上，而不是其官方网站了。</p><p>在 github release 中下载需要注意，不要下载 <code>win32.exe</code> 或 <code>win64.exe</code>，因为这两个执行文件的是安装包，安装好的 bin 文件夹下没有 <code>llvm-config</code> 程序。以 <code>19.1.0</code> 为例，需要下载下方的 <code>LLVM-19.1.0-Windows-X64.tar.xz</code> 文件。文件很大，所以如果下载不下来需要魔法才行，或者尝试去寻找并使用 github 文件下载加速站。</p><p><img src=select-file-from-github-release.png alt=select-file-from-github-release></p><p>下载好之后，将压缩包解压出来，建议路径中最好没有空格和非英文字母的字符。</p><p>解压好之后，可以直接在 bin 文件夹下看一下有没有 <code>llvm-config.exe</code>，确认好之后就需要配置环境变量了。</p><h3 id=设置环境变量>设置环境变量</h3><p>根据提示，可以在控制台中设置临时变量。设置好之后运行 <code>cargo check</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nb>set</span> <span class=nv>LLVM_SYS_191_PREFIX</span><span class=o>=</span>D:<span class=se>\\</span>Programs<span class=se>\\</span>LLVM
</span></span><span class=line><span class=cl>cargo check
</span></span></code></pre></div><p>如果还出现了编译错误，并且与上面提到的问题一致，则可能需要重启一下控制台、IDE 或者系统。</p><p>也可以设置到系统的环境变量里。</p><p><img src=set-env-for-system.png alt=set-env-for-system></p><p>没问题时，<code>cargo check</code> 应该会有如下输出：</p><p><img src=cargo-check-success.png alt=cargo-check-success></p><div class="notice note"><p class=notice-title><span class="icon-notice baseline"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 128 300 300"><path d="M150 128c82.813.0 150 67.188 150 150 0 82.813-67.188 150-150 150C67.187 428 0 360.812.0 278c0-82.813 67.188-150 150-150zm25 243.555v-37.11c0-3.515-2.734-6.445-6.055-6.445h-37.5c-3.515.0-6.445 2.93-6.445 6.445v37.11c0 3.515 2.93 6.445 6.445 6.445h37.5c3.32.0 6.055-2.93 6.055-6.445zm-.39-67.188 3.515-121.289c0-1.367-.586-2.734-1.953-3.516-1.172-.976-2.93-1.562-4.688-1.562h-42.968c-1.758.0-3.516.586-4.688 1.563-1.367.78-1.953 2.148-1.953 3.515l3.32 121.29c0 2.734 2.93 4.882 6.64 4.882h36.134c3.515.0 6.445-2.148 6.64-4.883z"/></svg></span>注释</p><p>如果出现了类似于 <code>cl.exe did not execute successfully</code> 的错误，可能是使用了 LLVM 的安装包安装，并且直接将原来的安装目录下的文件，替换为了下载好的完整 LLVM 包里的文件，或者是路径中包含了空格。</p></div></article><section class="article labels"><a class=category href=/categories/rust/>Rust</a><a class=tag href=/tags/rust/>Rust</a></section><section class="article author"><p class=name>学少何</p><div class=bio><em>不求上进的社畜……</em></div><div class=details><a class=item href=https://github.com/studylessshape target=_blank rel="noopener noreferrer"><span class="iconfont icon-github"></span>&nbsp;studylessshape</a></div></section></div><div class="article bottom"><section class="article navigation"><p><a class=link href=/post/note/archlinux-install-note/><span class="iconfont icon-article"></span>Archlinux 安装笔记</a></p></section></div></section><section id=footer><div style=display:flex;flex-direction:column;flex-wrap:wrap;justify-content:center;align-content:center;align-items:center><p style=flex-shrink:0>© 2024 学少何</p><p><span>Powered by </span><a href=https://gohugo.io target=_blank>Hugo</a><span> and the </span><a href=https://github.com/cntrump/hugo-notepadium target=_blank>Notepadium</a></p></div></section><script src=/js/hljs.min.6f979583f61e4ec5f0b94f94eab2e130ee628032474d374414dba4e33cc12097a0d01fe65b33378b23f6d3b053b95445.js integrity=sha384-b5eVg/YeTsXwuU+U6rLhMO5igDJHTTdEFNuk4zzBIJeg0B/mWzM3iyP207BTuVRF></script><script>hljs.initHighlightingOnLoad()</script></body></html>